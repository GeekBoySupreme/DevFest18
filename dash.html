<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>The Dictionary of Earth - NASA SpaceApp</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="../../dc/fa/css/font-awesome.min.css">
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Design Bootstrap -->
    <link href="css/mdb.min.css" rel="stylesheet">
    <!-- Your custom styles (optional) -->
    <link href="css/style.min.css" rel="stylesheet">
    <style type="text/css">
    html,
    body,
    header,
    .view {
        height: 100%;
    }

    @media (max-width: 740px) {
        html,
        body,
        header,
        .view {
            height: 1000px;
        }
    }

    @media (min-width: 800px) and (max-width: 850px) {
        html,
        body,
        header,
        .view {
            height: 650px;
        }
    }

    @media (min-width: 800px) and (max-width: 850px) {
        .navbar:not(.top-nav-collapse) {
            background: #1C2331!important;
        }
    }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar">
        <div class="container">
            <!-- Brand -->
            <a class="navbar-brand" href="#">
        <strong>Dictionary of Earth</strong>
      </a>
        </div>

        <a href="play.html"><button class="btn btn-success" style="float: left;">Quiz!</button></a>

        <a href="#"><button class="btn btn-indigo" style="float: right;" onclick="outUser(event)">Logout</button></a>



    </nav>
    <!-- Navbar -->
    <!-- Full Page Intro -->
    <div class="view full-page-intro" style="background-image: url('img/earth-min.jpg'); background-repeat: no-repeat; height: 100vh; background-size: cover; overflow-y: auto !important;">
        <!-- Mask & flexbox options-->
        <div class=" d-flex justify-content-center" style="overflow-y: auto; position: relative; margin-top: 15vh;">
            <!-- Content -->
            <div class="container">
                <!--Grid row-->
                <div class="row wow fadeIn">
                    <!--Grid column-->
                    <div class="col-md-4 mb-4 white-text text-center text-md-left">
                        <div class="card">
                            <!--Card content-->
                            <div class="card-body">
                                <!-- Form -->
                                <form name="">
                                    <!-- Heading -->
                                    <h3 class="dark-grey-text ">
                                        <strong>Find a word</strong>
                                    </h3>
                                    <hr>
                                    <div class="md-form">
                                        <input type="text" id="search-string" class="form-control">
                                        <label for="search-string">Tell me about...</label>
                                    </div>
                                    <div class="text-center">
                                        <button class="btn btn-indigo" id="search-btn" onclick="findWord(event)">Find</button>
                                    </div>
                                </form>
                                <!-- Form -->
                            </div>
                            <span id="res" style="display: none;">

                                <hr>

                                <div class="card-body">

                                        <!-- Heading -->
                                        <h3 class="dark-grey-text "  style="text-align: left;">
                                        <strong id="res-query" ></strong>
                                      </h3>
                                        <hr>
                                        <div id="res-def" style="text-align: left;color: #2c2c2c;"></div>
                                        <hr>
                                        <div id="res-desc" style="text-align: left;color: #2c2c2c;"></div>
                                        <hr>
                                        <div id="res-action" style="text-align: left;color: #2c2c2c;"></div>
                                        <br><br>
                                </div>

                            </span>
                        </div>
                    </div>
                    <!--Grid column-->
                    <!--Grid column-->
                    <div class="col-md-8 col-xl-8 mb-4">
                        <!--Card-->
                        <div class="card">
                            <!--Card content-->
                            <div class="card-body">
                                <!-- Form -->
                                <form name="">
                                    <!-- Heading -->
                                    <h5 class="dark-grey-text text-left">
                    <strong>Create Post</strong>
                  </h5>

                                    <div class="md-form">
                                        <i class="fa fa-user prefix grey-text"></i>
                                        <input type="text" id="title-string" class="form-control">
                                        <label for="title-string">Title</label>
                                    </div>
                                    <div class="md-form">
                                        <i class="fa fa-envelope prefix grey-text"></i>
                                        <textarea type="text" id="story-string" class="form-control"> </textarea>
                                        <label for="story-string">Description</label>
                                    </div>
                                    <div class="text-center">
                                        <button class="btn btn-indigo btn-sm" style="float: right;" onclick="makePost(event);">Share</button>
                                    </div>
                                </form>
                                <!-- Form -->
                            </div>
                        </div>
                        <br />
                        <div class="card">
                            <!--Card content-->
                            <div class="card-body" id="feed-container">
                                <!-- Form -->
                                Loading feeds...
                            </div>
                        </div>
                        <!--/.Card-->
                    </div>
                    <!--Grid column-->
                </div>
                <!--Grid row-->
            </div>
            <!-- Content -->
        </div>
        <!-- Mask & flexbox options-->
    </div>

    <div id="suggest-modal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
    <!--     <button type="button" class="close btn btn-danger" style="float: right;" data-dismiss="modal">&times;</button> -->
        <h4 class="modal-title">Suggest Improvement</h4>
      </div>
      <div class="modal-body">
        <input id="suggest-string" type="text" class='form-control' placeholder="Your suggestion here..."></input>
        <input id="suggest-wordid" type="text" style="display: none;"></input>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" onclick="doSuggest(event);">Submit</button>
      </div>
    </div>

  </div>
</div>

    <!-- Full Page Intro -->
    <!--/.Footer-->
    <!-- SCRIPTS -->
    <!-- JQuery -->
    <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
    <!-- Bootstrap tooltips -->
    <script type="text/javascript" src="js/popper.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="js/bootstrap.min.js"></script>
    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- Initializations -->
    <script type="text/javascript">
    // Animations initialization
    new WOW().init();


    $( document ).ready(function() {
        fetchFeed();
    });

    function fetchFeed(){

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "fetchFeed"}
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);

            var data = res.message;

            if (res.status - 2 + 1 + 1 == 0) {

                $('#feed-container').empty();

                var len = data.length;

                for(i=0;i<len; i++){

                    postid = 0;
                    var type = 1;

                    if ("postid" in data[i]){
                        postid = data[i].postid;
                        type = 1;
                    }
                    else{
                        postid = data[i].shareid;
                        type = 2;
                    }


                    $('#feed-container').append("<a href='profile.html?name="+data[i].user.username+"'>"+data[i].user.username+"</a> &middot; "+data[i].user.rep+"<br><br><span style='font-size: large;'><strong>"+data[i].title+"</strong></span><br>"+data[i].story+"<div class='btn-group' style='float:right;'><button type='button' class='btn-success btn' style='padding:0.5em 1em;'>"+data[i].upvotes+"</button><button type='button' class='btn-success btn' style='padding:0.5em 1em;' onclick='goUp(event, "+postid+", "+type+")'><i class='fa fa-arrow-up'></i></button><button type='button' class='btn-danger btn' style='padding:0.5em 1em;' onclick='goDown(event, "+postid+", "+type+")'><i class='fa fa-arrow-down'></i></button><button type='button' class='btn-danger btn' style='padding:0.5em 1em;'>"+data[i].downvotes+"</button></div><hr>");

                    // <button type='button' class='btn-primary btn-xs'>Share</button>
                }

            }
        });

    }

    function findWord(e) {

        e.preventDefault();

        var query = $('#search-string').val();

        console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "fetchWord", word: query }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if (res.status - 2 + 1 + 1 == 0) {

                $('#res-query').empty().append(res.message.matched_query);
                $('#res-def').empty().append(res.message.meaning);
                $('#res-desc').empty().append(res.message.related);

                data = res.message;
                wordid = data.matched_query_id;

                $('#res-action').empty().append("<a href='#' onclick='suggest("+wordid+")'>Improve?</a><div class='btn-group' style='float:right;'><button type='button' class='btn-success btn' style='padding:0.5em 1em;'>"+data.upvotes+"</button><button type='button' class='btn-success btn' style='padding:0.5em 1em;' onclick='wordUp(event, "+wordid+")'><i class='fa fa-arrow-up'></i></button><button type='button' class='btn-danger btn' style='padding:0.5em 1em;' onclick='wordDown(event, "+wordid+")'><i class='fa fa-arrow-down'></i></button><button type='button' class='btn-danger btn' style='padding:0.5em 1em;'>"+data.downvotes+"</button></div>");

                $('#res').slideDown();

            }
        });

    }



    function suggest(wordid){
        $('#suggest-modal').modal('show');

        $('#suggest-wordid').val(wordid);
    }

    function doSuggest(e) {

        e.preventDefault();

        var wordid = $('#suggest-wordid').val();
        var sug = $('#suggest-string').val();

        console.log(wordid);

        var userid = getCookie("userid");

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "doSuggest", wordid: wordid, userid: userid, def: sug }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if (res.status - 2 + 1 + 1 == 0) {

                $('#suggest-modal').modal("hide");

            }
        });

    }

    function makePost(e) {

        e.preventDefault();

        var title = $('#title-string').val();
        var story = $('#story-string').val();

        var userid = getCookie("userid");
        // console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "addPost", userid: userid, title: title, story: story, image:"", link:"" }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){

                $('#title-string').val("");
                $('#story-string').val("");

                fetchFeed();

            }
        });

    }

    function goUp(e, postid, type) {

        e.preventDefault();

        var userid = getCookie("userid");
        // console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "goUp", userid: userid, postid: postid, type: type }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){

                fetchFeed();

            }
        });

    }


    function goDown(e, postid, type) {

        e.preventDefault();

        var userid = getCookie("userid");
        // console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "goDown", userid: userid, postid: postid, type: type }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){

                // $('#title-string').val("");
                // $('#story-string').val("");

                fetchFeed();

            }
        });

    }

    function wordUp(e, wordid) {

        e.preventDefault();

        var userid = getCookie("userid");
        // console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "wordUp", userid: userid, wordid: wordid}
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){

                findWord(e);

            }
        });

    }


    function wordDown(e, wordid) {

        e.preventDefault();

        var userid = getCookie("userid");
        // console.log(query);

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "wordDown", userid: userid, wordid: wordid}
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){
                findWord(e);
            }
        });

    }

    function outUser(e) {

        e.preventDefault();

        $.ajax({
            type: "GET",
            url: "http://192.168.43.128/spaceapps/eapi/api.php",
            data: { command: "outUser" }
        }).done(function(result) {

            console.log(result);

            var res = JSON.parse(result);
            console.log(res);
            if(res.status - 2 + 1 + 1 == 0){

                window.location = "index.html";

            }
        });

    }




    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i <ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }

    </script>
</body>

</html>